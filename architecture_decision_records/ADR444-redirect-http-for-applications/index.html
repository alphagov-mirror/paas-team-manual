<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>GOV.UK Documentation</title>

    <!--[if gt IE 8]><!--><link href="../../stylesheets/screen.css" rel="stylesheet" media="screen" /><!--<![endif]-->
    <!--[if lte IE 8]><link href="../../stylesheets/screen-old-ie.css" rel="stylesheet" media="screen" /><![endif]-->

    <link rel="canonical" href="https://alphagov.github.io/paas-team-manual/architecture_decision_records/ADR444-redirect-http-for-applications/">


    <link href="../../stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="../../javascripts/application.js"></script>
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
  <div class="header__container">
    <div class="header__brand">
        <a href="https://alphagov.github.io/paas-team-manual">
        <span class="header__title">
          PaaS Team Manual
            <span class="phase-banner">Internal</span>
        </span>
        </a>
    </div>

  </div>
</header>

      </div>

      <div id="toc-heading" class="toc-show fixedsticky">
        <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
          Table of contents <span class="toc-show__icon"></span>
        </a>
      </div>

      <div class="app-pane__body" data-module="in-page-navigation">
        <div class="app-pane__toc">
          <div class="toc" data-module="table-of-contents">
            <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
            <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
              <ul>
  <li>
    <a href="#adr444-redirect-http-for-applications">ADR444: Redirect HTTP for applications</a>
    <ul>
      <li>
        <a href="#context">Context</a>
        <ul>
          <li>
            <a href="#update-the-cf-cli-to-include-the-scheme">Update the CF CLI to include the scheme</a>
          </li>
          <li>
            <a href="#redirect-http-to-https">Redirect http to https</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#decision">Decision</a>
      </li>
      <li>
        <a href="#status">Status</a>
      </li>
      <li>
        <a href="#consequences">Consequences</a>
      </li>
    </ul>
  </li>
</ul>

            </nav>
          </div>
        </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="page-banner">
    <p>This is for internal use by the PaaS team. Public-facing documentation is located at <a href="https://docs.cloud.service.gov.uk">docs.cloud.service.gov.uk</a>.</p>
  </div>

  <h1 id="adr444-redirect-http-for-applications">ADR444: Redirect HTTP for applications</h1><h2 id="context">Context</h2>
<p>In <a href="../ADR443-ssl-only-for-applications-and-cf-endpoints">ADR443</a> we decided that
we would only support https for applications on the PaaS, and that we would
drop plain http connections (port 80).</p>

<p>Since then, we&rsquo;ve observed this causing confusion for users on numerous
occasions where they think their app isn&rsquo;t working after being pushed.</p>

<p>The situation is improved with the inclusion of the <code>cloudapps.digital</code> domain
in the <a href="https://hstspreload.org/?domain=cloudapps.digital">HSTS preload</a> list,
but this only helps users with recent versions of modern browsers.</p>

<p>As a result of the continued confusion for users we should revisit the decision
from ADR443.</p>

<p>There are a number of things that could be done to address this:</p>
<h3 id="update-the-cf-cli-to-include-the-scheme">Update the CF CLI to include the scheme</h3>
<p>Currently, the CF CLI outputs the fully-qualified hostname of the app after
pushing, but doesn&rsquo;t include the scheme. This has caused confusion for users
when this is copy/pasted into browsers, and then times out.</p>

<p>Getting the CLI to include the scheme here will help with the specific case of
users getting confused immediately after pushing an app.</p>

<p>It&rsquo;s unclear how much work this involves, as currently information about
whether a route is http or https doesn&rsquo;t appear to be modeled in CloudFoundry
anywhere.</p>

<p>If this involves changes to the CLI, there&rsquo;s no guarantee that users will
upgrade their CLI.</p>

<p>Additionally, there is some debate about how effective this change would be. It
will probably fix some cases, but won&rsquo;t cover everything.</p>
<h3 id="redirect-http-to-https">Redirect http to https</h3>
<p>Add an endpoint that listens to all http requests on cloudapps.digital and
redirects them to the corresponding https URL.</p>

<p>There&rsquo;s a risk with this that a service could link to the http version of a
page by mistake and not notice due to the redirect. We can mitigate this be
having the redirect strip the path and query when redirecting so that it always
redirects to the base URL.</p>

<p>There&rsquo;s another risk that a misconfiguration could allow non-encrypted traffic
through to applications. This would need to be mitigated by having acceptance
tests to cover this.</p>
<h2 id="decision">Decision</h2>
<p>We will redirect http traffic to the corresponding root https endpoint.</p>

<p>We will continue to maintain HSTS preload lists for our production domains.</p>
<h2 id="status">Status</h2>
<p>Accepted</p>
<h2 id="consequences">Consequences</h2>
<p>We must configure and maintain an endpoint on the routers that accepts http
connections and redirects to the corresponding base https endpoint.</p>


          </main>

          <footer class="footer">
  <div class="footer__licence">
    <a class="footer__licence-logo" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a>
    <p class="footer__licence-description">All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
  </div>

  <div class="footer__copyright">
    <a class="footer__copyright-logo" href="http://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/copyright-and-re-use/crown-copyright/">Â© Crown copyright</a>
  </div>
</footer>

        </div>
      </div>
    </div>

    
  </body>
</html>
